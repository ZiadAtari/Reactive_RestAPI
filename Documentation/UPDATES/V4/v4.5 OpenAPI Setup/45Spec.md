# v4.5 Specification: Swagger OpenAPI 3.0 Integration

## Overview
This update introduces **OpenAPI 3.0** (formerly Swagger) support to the Reactive API. This moves the project towards a **Design-First** methodology, where the API contract is the source of truth. Automatic request validation and interactive documentation (Swagger UI) will be implemented to improve developer experience and reliability.

## Requirements

### 1. Functional Requirements
*   **OpenAPI Specification**: A complete `openapi.yaml` file must be created to describe all existing endpoints:
    *   `POST /login`
    *   `GET /v1/employees`, `POST /v1/employees`, `PUT /v1/employees/:id`, `DELETE /v1/employees/:id`
    *   `GET /v3/employees`, `POST /v3/employees`, `PUT /v3/employees/:id`, `DELETE /v3/employees/:id`
    *   Health checks (`/health/live`)
*   **Automatic Validation**: The application must automatically validate incoming requests (headers, query params, body) against the OpenAPI spec *before* they reach the controllers. This replaces manual `SchemaValidator` calls.
*   **Interactive UI**: A Swagger UI instance must be exposed at `/swagger` to allow developers to test endpoints interactively.
*   **Error Handling**: Validation errors generated by the OpenAPI framework must be mapped to the existing standard `ApiError` format (e.g., maintaining `VALIDATION_ERROR` codes).

### 2. Technical Requirements
*   **Library**: Use `vertx-web-openapi` (compatible with Vert.x 4.x) for Router generation.
*   **Integration**:
    *   The `RouterBuilder` should be used to mount handlers using **Operation IDs**.
    *   Existing `Controller` logic should be preserved but stripped of manual validation.
    *   `GlobalErrorHandler` must support `ValidationException` mapping.
*   **Security Schemes**: The spec must define:
    *   `BearerAuth` (JWT) for V3 routes.
    *   No auth for V1/Login.
    *   **Middleware Integration**:
        *   **Global Handlers**: `BodyHandler` (managed by RouterBuilder?) and `RateLimitHandler` must be correctly ordered.
        *   **Custom Middleware**: The `VerificationHandler` (IP Check) must be applied to `/v1/*` and `/v3/*` paths on the generated router.
    *   **Infrastructure Routes**: Endpoints like `/metrics` and `/health/live` should be kept separate from the OpenAPI validation logic (or defined loosely) to avoid unnecessary overhead, but mounted on the same HTTP server.

### 3. Design Rationale: Why RouterBuilder?
Transitioning from manual `SchemaValidator` to `RouterBuilder` offers significant architectural advantages:

*   **Safety (Contract-Driven)**: The OpenAPI spec becomes the single source of truth. `RouterBuilder` enforces strict validation against this contract before requests reach the handler. This eliminates "Documentation Drift" where the docs say one thing (e.g., "required") but the code does another.
*   **Modularity**: Validation logic is completely decoupled from business logic. The Controller receives a `RoutingContext` guaranteed to contain valid data, allowing it to focus solely on orchestration and response building.
*   **Clean Code**: It removes repetitive boilerplate validation code (e.g., `if (json.getValue("age") < 0)`) from Controllers, making them leaner and more readable.

## Scope

### In Scope
*   Creation of `src/main/resources/openapi.yaml`.
*   Refactoring `HttpVerticle` to build the router from the spec.
*   Simplifying `EmployeeController` and `AuthController` by removing `SchemaValidator` dependencies.
*   Adding `swagger-ui` static assets to `src/main/resources/webroot/swagger`.
*   Updating `pom.xml` with `vertx-web-openapi`.

### Out of Scope
*   Client SDK generation.
*   Changes to the Database or Repository layer.
*   Changes to the business logic inside `EmployeeService`.
*   Modifying the DemoAPI.

## Risk Assessment
*   **Breaking Changes**: If the OpenApi spec validation is stricter than the old `SchemaValidator`, clients sending marginally invalid data (previously ignored) might now be rejected.
*   **Startup Time**: Parsing a large YAML spec at startup might add milliseconds to boot time (negligible).
